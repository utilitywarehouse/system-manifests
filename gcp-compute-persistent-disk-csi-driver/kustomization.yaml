apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
# gcp-compute-persistent-disk-csi-driver puts everything under a namespace
# called `gce-pd-csi-driver` and put Cluster scoped resources under the same
# base. Add an additional overlay to hack the ns and put everything under
# kube-system to play with the method we apply cluster resources via KA
namespace: kube-system

# Use a commit ref instead of tag, as images do not follow tags in the repo
#  manifests.
resources:
  - github.com/kubernetes-sigs/gcp-compute-persistent-disk-csi-driver/deploy/kubernetes/overlays/stable-master?ref=efb4c18479363c271d69a36afef439513ce7186b # v1.17.2

patches:
  - path: csi-gce-pd-controller-patch.yaml
  - target:
      group: rbac.authorization.k8s.io
      version: v1
      kind: ClusterRole
      name: csi-gce-pd-provisioner-role
    path: csi-gce-pd-provisioner-role-patch.yaml
