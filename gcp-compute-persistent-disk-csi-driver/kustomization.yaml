apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
# gcp-compute-persistent-disk-csi-driver puts everything under a namespace
# called `gce-pd-csi-driver` and put Cluster scoped resources under the same
# base. Add an additional overlay to hack the ns and put everything under
# kube-system to play with the method we apply cluster resources via KA
namespace: kube-system
bases:
  # Use a commit ref instead of tag, as images do not follow tags in the repo
  #  manifests.
  - github.com/kubernetes-sigs/gcp-compute-persistent-disk-csi-driver/deploy/kubernetes/overlays/stable-1-24?ref=0954dbd48d7f3634bfb1133d492a8d1b03bb3dc3
patchesStrategicMerge:
  - csi-gce-pd-controller-patch.yaml

# Seems like they stopped patching images in the Kubernetes deployment manifests
# provided from upstream. Lets do it here:
images:
  - name: k8s.gcr.io/cloud-provider-gcp/gcp-compute-persistent-disk-csi-driver
    newTag: v1.18.1
