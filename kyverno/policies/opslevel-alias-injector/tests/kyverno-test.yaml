name: opslevel_data_injection 
policies:
  - ../opslevel-alias-injector.yaml
variables: variables.yaml
resources:
  - deployment-without-data.yaml
  - deployment-without-data-multiple-containers.yaml
  - deployment-with-different-name.yaml
  - deployment-with-data.yaml
  - deployment-in-other-namespace.yaml
  - statefulset-without-data.yaml
  - statefulset-with-different-name.yaml
  - statefulset-with-data.yaml
  - statefulset-in-other-namespace.yaml
  - cronjob-without-data.yaml
  - cronjob-with-different-name.yaml
  - cronjob-with-data.yaml
  - cronjob-in-other-namespace.yaml
results:
  # Deployment tests
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-deployments
    resource: without-data
    patchedResource: deployment-without-data-patch.yaml
    kind: Deployment
    result: pass
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-deployments
    resource: without-data-multiple-containers
    patchedResource: deployment-without-data-multiple-containers-patch.yaml
    kind: Deployment
    result: pass
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-deployments
    resource: with-different-name
    patchedResource: deployment-with-different-name-patch.yaml
    kind: Deployment
    result: pass
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-deployments
    resource: with-data
    kind: Deployment
    result: skip
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-deployments
    resource: in-another-namespace
    kind: Deployment
    result: skip
  # StatefulSet tests
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-statefulsets
    resource: without-data
    patchedResource: statefulset-without-data-patch.yaml
    kind: StatefulSet
    result: pass
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-statefulsets
    resource: with-different-name
    patchedResource: statefulset-with-different-name-patch.yaml
    kind: StatefulSet
    result: pass
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-statefulsets
    resource: with-data
    kind: StatefulSet
    result: skip
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-statefulsets
    resource: in-another-namespace
    kind: StatefulSet
    result: skip
  # CronJob tests
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-cronjobs
    resource: without-data
    patchedResource: cronjob-without-data-patch.yaml
    kind: CronJob
    result: pass
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-cronjobs
    resource: with-different-name
    patchedResource: cronjob-with-different-name-patch.yaml
    kind: CronJob
    result: pass
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-cronjobs
    resource: with-data
    kind: CronJob
    result: skip
  - policy: opslevel-alias-injector
    rule: inject-opslevel-alias-for-cronjobs
    resource: in-another-namespace
    kind: CronJob
    result: skip
