apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kube-system

resources:
  - github.com/kyverno/kyverno/config?ref=v1.8.4
  - kyverno-pdb.yaml
  - policies/

# Kyverno changed images to point to latest in:
# https://github.com/kyverno/kyverno/pull/4738
# Change them back to point to the deployed version
images:
  - name: ghcr.io/kyverno/kyverno
    newTag: v1.8.4
  - name: ghcr.io/kyverno/kyvernopre
    newTag: v1.8.4

patches:
  - path: delete-ns.yaml
  - path: deployment-arguments-patch.yaml
  - path: deployment-master-schedule-patch.yaml
  - path: deployment-replicas-patch.yaml
  - path: kyverno-config-patch.yaml
  - path: metrics-svc-patch.yaml
