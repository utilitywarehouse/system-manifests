apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: master-speaker
  namespace: sys-metallb
spec:
  template:
    spec:
      containers:
        - args:
            - --port=7472
            - --log-level=info
            - --lb-class=master-speaker
          env:
            - $patch: delete
              name: METALLB_ML_BIND_ADDR
            - $patch: delete
              name: METALLB_ML_LABELS
            - $patch: delete
              name: METALLB_ML_SECRET_KEY
          name: speaker
          ports:
            - containerPort: 7472
              name: monitoring
            - $patch: replace
          resources:
            limits:
              cpu: 100m
              memory: 100Mi
      nodeSelector:
        role: master
      tolerations:
        - effect: NoSchedule
          key: node-role.kubernetes.io/master
        - effect: NoSchedule
          operator: Exists
        - key: CriticalAddonsOnly
          operator: Exists
        - effect: NoExecute
          operator: Exists
