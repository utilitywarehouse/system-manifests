apiVersion: apps/v1
kind: Deployment
metadata:
  name: gatekeeper-audit
spec:
  template:
    spec:
      containers:
        - name: manager
          args:
            # Args from the upstream
            - --audit-interval=60
            # --log-level=INFO
            - --constraint-violations-limit=20
            - --audit-from-cache=false
            - --audit-chunk-size=500
            # --audit-match-kind-only=false
            - --emit-audit-events=false
            - --operation=audit
            - --operation=status
            # --operation=mutation-status
            - --logtostderr
            - --health-addr=:9090
            - --prometheus-port=8888
            - --enable-external-data=false
            # Args added/edited by us
            # * Reduce log noise
            # * Reduce memory footprint by only requesting kinds we have
            #   constraints for and disabling mutation
            - --log-level=WARNING
            - --audit-match-kind-only=true
          resources:
            limits:
              cpu: 2500m
              memory: 1000Mi
            requests:
              cpu: 200m
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gatekeeper-controller-manager
spec:
  template:
    spec:
      containers:
        - name: manager
          args:
            # Args from the upstream
            - --port=8443
            - --health-addr=:9090
            - --prometheus-port=8888
            - --logtostderr
            - --log-denies=false
            - --emit-admission-events=false
            # --log-level=INFO
            # --exempt-namespace=default
            - --operation=webhook
            - --enable-external-data=false
            # --operation=mutation-webhook
            # Args added/edited by us
            # * Reduce log noise
            # * Reduce memory footprint by disabling mutation
            # * Disable automatic generation and rotation of TLS certs/keys
            - --log-level=WARNING
            - --exempt-namespace=$(POD_NAMESPACE)
            - --disable-cert-rotation
          resources:
            limits:
              cpu: 6000m
              memory: 4000Mi
            requests:
              cpu: 200m
