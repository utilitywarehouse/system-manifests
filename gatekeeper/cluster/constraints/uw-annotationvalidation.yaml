# Validate aws role arn
apiVersion: constraints.gatekeeper.sh/v1beta1
kind: AnnotationValidation
metadata:
  name: vault-aws-role-arn
spec:
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["ServiceAccount"]
  parameters:
    message: "The annotation `vault.uw.systems/aws-role` must contain a valid role arn"
    annotations:
      - key: "vault.uw.systems/aws-role"
        # adapted from: https://docs.aws.amazon.com/IAM/latest/APIReference/API_CreateRole.html
        allowedRegex: '^arn:aws:iam::[0-9]+:role((/)|(/[\x21-\x7f]+/))[\w+=,.@-]+$'
